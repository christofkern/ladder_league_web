<!DOCTYPE html>
<html>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='styles_layout3P.css') }}">


<body class="layout3P" width=1920px height=1080px>
    <div id="name1" class="runnername"></div>
    <div id="name2" class="runnername"></div>
    <div id="name3" class="runnername"></div>
    
<div class="statistics">
    <div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="false"  style="width:100%">
        <div class="carousel-inner" id="carousel-inner">   	
            <!-- Initial Slide -->
            <div class="carousel-item active">
                <div class="pt-4 carousel-header">Loading...</div>
            </div>
        </div>
    </div>
</div>

<!--
</div>
    <div class="commentators">
        <div class="block" style="height: 100%;">            
            <div class="centered" id="cbox">
                <div class="child">
                    P53
                </div>
            </div>            
        </div>
    </div>
</div>

<div class="timer" id="main_timer">
   
00:00:00
</div>
 -->
</body>

<div class="overlay-p1 invisible">       
    <p id="overlay-p1" class="overlay-text"></p>    
</div>

<div class="overlay-p2 invisible">       
    <p id="overlay-p2"  class="overlay-text"></p>    
</div>

<div class="overlay-p3 invisible">       
    <p id="overlay-p3" class="overlay-text"></p>    
</div>

<script>

    let s_id = "{{spreadsheet_id}}";
    let race_name = ""

    function setTitleAndRunners(){
        fetch('/static_info?spreadsheet_id=' + encodeURIComponent(s_id))
            .then(response => response.json())
                .then(data => {      
                    //check if there is an entry error, if not extract the entries 'racename', 'runners', 'country_urls'. The both last are arrys in python
                    if (data.error) {
                        console.error("Error in data:", data.error);
                    } else {
                        const racename = data[0].racename;
                        const runners = data[1].runners;
                        const country_urls = data[2].country_urls;

                        race_name = racename

                        for (var i = 0; i < Math.min(3, runners.length); i++) {
                            var fieldName = 'name' + (i + 1);
                            document.getElementById(fieldName).innerHTML = runners[i] + '&nbsp<img src="' + country_urls[i] + '" style="width: 64px">'
                        }

                        //initialize the carousel from here
                        initializeCarousel();

                    }
                })
        .catch(error => {
            console.error("Error fetching static info", error);
        });
    }

    function initializeCarousel(){
        const carouselInner = document.getElementById('carousel-inner');
        const newSlide = `
                <div class="carousel-item">
                    <div class="pt-4 carousel-racename">${race_name}</div>
                </div>
            `;
        carouselInner.innerHTML += (newSlide);
        goNextSlide();
    }

    function goNextSlide() {
        $('#carouselExampleSlidesOnly').carousel('next');
    }

    setTitleAndRunners();
    


</script>

<script>
    /*
    var timer = 0;
    var startDate = null;
    var actualEnd = null;
    
    $( document ).ready(function() {
        setInterval(function() {
            $.ajax({
                url: 'http://10.10.0.221:28010/event?host={{ automarathon_host }}', 
                type: 'GET',
                headers: {'Access-Control-Allow-Origin':'*'}, // <-------- set this
                dataType: 'text', // // <-------- use JSONP
                success: function(data){
                    data = JSON.parse(data);
                    console.log(data)

                    if (data.hasOwnProperty('start_time')) {
		    var startTime = data['start_time']
                    if (startTime == null) {
                        startDate = null
                    } else {
                        startDate = new Date(startTime)
                    }
                    }

                    if(data.hasOwnProperty('end_time')){
                        actualEnd =  data['end_time'] != null ? new Date(data['end_time']) : null;
                    }


                    if (startDate == null) {
                    document.getElementById("main_timer").innerHTML = toTime(0);
                    } else {
                    var endDate = actualEnd == null ? new Date() : actualEnd;
                    var timer = (endDate.getTime() - startDate.getTime());
                    document.getElementById("main_timer").innerHTML = toTime(timer);
                    }
                }
            });
        }, 1000);
    });
    
    $( document ).ready(function() {
        setInterval(function() {
            $.ajax({
    		url: 'http://10.10.0.221:28010/commentators?host={{ automarathon_host }}', 
                type: 'GET',
                headers: {'Access-Control-Allow-Origin':'*'}, // <-------- set this
                dataType: 'text', // // <-------- use JSONP
                success: function(data){
                    data = JSON.parse(data);
    		    setCommentators(data);
                }
            });
        }, 1000);
    });

    function timer() {
    }
    setInterval(timer, 500);
    */
</script>

</html>
